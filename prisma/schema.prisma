generator client {
  provider = "prisma-client-js"
  
}

datasource db {
  provider  = "mysql"
  url       = env("DATABASE_URL")
  //directUrl = env("DIRECT_URL")
}


model User {
  id                  Int      @id @default(autoincrement())
  name                String
  email               String   @unique
  password            String
  role                String   @default("member")
  created_at DateTime  @default(now()) @db.Timestamp(6)
  updated_at DateTime? @default(now()) @db.Timestamp(6)
files UserFile[]
projects Project[]
}


model Project {
  id          Int      @id @default(autoincrement())
  name        String   
  description String?  
  status      String   @default("กำลังดำเนินการ") 
  statusNote  String?  
  
  created_at DateTime  @default(now()) @db.Timestamp(6)
  updated_at DateTime? @default(now()) @db.Timestamp(6)

 
  userId Int

 
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  files UserFile[]

  @@index([userId])
}

model UserFile {
  id               Int @id @default(autoincrement())
  originalFileName String
  storagePath      String
  fileExtension    String
  downloadStatus   String @default("pending") 
  downloadedAt     DateTime? 

  created_at DateTime  @default(now()) @db.Timestamp(6)
  updated_at DateTime? @default(now()) @db.Timestamp(6)

  // Foreign keys
  userId Int
  projectId Int?  

  // Relationships
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  project Project? @relation(fields: [projectId], references: [id], onDelete: SetNull)
  attachmentFiles AttachmentFile[] // ความสัมพันธ์กับไฟล์แนบ

  @@index([userId])
  @@index([projectId])
}


model AttachmentFile {
  id       Int    @id @default(autoincrement())
  fileName String
  filePath String
  fileSize Int
  mimeType String

  created_at DateTime  @default(now()) @db.Timestamp(6)
  updated_at DateTime? @default(now()) @db.Timestamp(6)

  // Foreign key linking to the UserFile model
  userFileId Int

  // Relationships
  userFile UserFile @relation(fields: [userFileId], references: [id], onDelete: Cascade)

  @@index([userFileId])
}


model ContractCounter {
  id            Int      @id @default(autoincrement())
  contractType  String   @unique 
  currentNumber Int      @default(1) 
  
  created_at DateTime  @default(now()) @db.Timestamp(6)
  updated_at DateTime? @default(now()) @db.Timestamp(6)
}